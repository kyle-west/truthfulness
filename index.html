<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <title>Truth Tables</title>
      <script type="text/javascript" src="polyfills.js"></script>
      <script type="text/javascript" src="constants.js"></script>
      <script type="text/javascript" src="understanding.js"></script>
      <script type="text/javascript" src="io-control.js"></script>
      <script type="text/javascript" src="logic.js"></script>
      <script type="text/javascript" src="truth.js"></script>
      <link rel="stylesheet" href="appearance.css">
      <link rel="icon" href="favicon.ico" />
   </head>
   <body onload="io_init()">
      <main>
         <h1>Truth Table Generator</h1>
         <div class="settings-btn" onclick="OPTIONS.show()">
            <svg class="icon-settings size-32"></svg>
         </div>
         <hr>
         <p>
            Type in an expression, then hit the [Evaluate] button to see the results.
         </p>
         <form onsubmit="return false;">
            <input type="text" id="raw-input" placeholder="Example: p ∨ ¬q">
            <input type="submit" class="eval" onclick="main()" value="Evaluate">
         </form>
         <br/><br/>
         <div id="raw-results"></div>
         <table id="raw-results-sticky-header" class="hidden"></table>
         <div class="notify">Copied!</div>
         <div class="box-70">
            <input type="button" onclick="copyAsORG()" value="Copy as ORG Table">
            <textarea id='org-table'></textarea>
         </div>
         <div class="box-30">
            <input type="button" onclick="copyAsJSON()" value="Copy as JSON"><br/>
            <textarea id='json-table'></textarea>
         </div>
      </main>
      <div class="credits">
         Created by <a href="https://github.com/kyle-west" target="_blank">Kyle West</a> <br>
         Hosted on <a href="https://github.com/kyle-west/truthfulness" target="_blank">GitHub</a><br>
         <a href="https://github.com/kyle-west/truthfulness/issues" target="_blank">[Report an issue]</a>
      </div>

      <div class="modal hidden" id="settings-modal">
         <div class="content">
            <h1>Display Options</h1>
            <hr>
            <p><b>Table display:</b> Select how you would like to view the truth table results</p>
            <input id="tv1" type="radio" name="table-view" value="inline"><label for="tv1">Results Inline</label></input><br/>
            <input id="tv2" type="radio" name="table-view" value="expanded"><label for="tv2">Expanded View</label></input><br/><br/>
            <p><b>Boolean Representation:</b> Select which way you would like to have True / False displayed</p>
            <input id="b1" type="radio" name="true-false" value="binary"><label for="b1">True as "1", False as "0"</label></input><br/>
            <input id="b2" type="radio" name="true-false" value="letter"><label for="b2">True as "T", False as "F"</label></input><br/>
            <div class="footer">
               <button type="button" class="done" onclick="OPTIONS.save()">Save</button>
               <button type="button" class="cancel" onclick="OPTIONS.close(true)">Cancel</button>
            </div>
         </div>
      </div>

      <script>
         var STICK_HEADER = document.querySelector('#raw-results-sticky-header');

         // return the cursor to its "original" position after pretty print
         document.getElementById("raw-input").addEventListener("input", (e) => {
            var prettyText = interpretSymbols(e.target.value);
            var cursorPos  = e.target.selectionStart + prettyText.sizeDiff;
            e.target.value = prettyText.text;
            e.target.setSelectionRange(cursorPos, cursorPos);
         });

         // watch on the table content change to update the sticky header
         document.getElementById("raw-results").addEventListener("DOMSubtreeModified", (e) => {
            var header = e.target.querySelector('#raw-results-header');
            if (header) {
               STICK_HEADER.innerHTML = "<thead>" + header.innerHTML + "</thead>";
            }
         });

         // show the sticky header when the attached header is out of view.
         window.onscroll = function(e) {
            var header = document.querySelector('#raw-results thead');
            if (header && (header.getBoundingClientRect().y > 0)) {
               STICK_HEADER.classList.add('hidden');
            } else {
               STICK_HEADER.classList.remove('hidden');
            }
         }

      </script>

      <script type="text/javascript" src="preferences.js"></script>
   </body>
</html>
